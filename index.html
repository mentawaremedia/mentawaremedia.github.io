
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Very Good Indicators</title>
  <meta name="author" content="Mentaware Media">

  
  <meta name="description" content="Ok, so I took an old play from the American media and used a sensationalized
title to get your attention. The fact is that I like ActiveRecord, I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.verygoodindicators.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Very Good Indicators" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>

  
  
    
  
  
  
  

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Imprima' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Armata' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-57121489-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Very Good Indicators</a></h1>
  
    <h2>Experience by design</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/20/why-activerecord-sucks/">Why ActiveRecord Sucks</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-20T21:49:23-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:49 pm</span></time>
        
           | <a href="/blog/2015/04/20/why-activerecord-sucks/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/20/why-activerecord-sucks/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/aww-man-this-topics-sucks.jpg" width="300"></p>

<p>Ok, so I took an old play from the American media and used a sensationalized
title to get your attention. The fact is that I like ActiveRecord, I really do.
In fact I like it a little too much.</p>

<p>If you haven&rsquo;t done so you should read my last blog post titled <a href="http://www.verygoodindicators.com/blog/2015/04/19/easy-vs-simple/">&lsquo;Easy vs Simple&rsquo;</a>.
It&rsquo;s an article very much inspired by a <a href="http://www.infoq.com/presentations/Simple-Made-Easy">talk</a>
given by the creator of Clojure, Rich Hickey. The point my article and one of the many fine
points in Hickey&rsquo;s lecture attempts to make is that we as developers
have become obsessed with this idea of &lsquo;easy&rsquo;. So much are we enamored by it that
we&rsquo;re trading it in for a vast amount of complexity and inefficiency.</p>

<p>Giving you a little of my background, I&rsquo;ve had the pleasure working for two very
experienced and well known people in our profession. The first was Dave Thomas author
of the Pickaxe Book and Hal Helms who is very well known in the ColdFusion community.
I currently work for Hal and we have some fairly interesting discussions and arguements.
One revolves around ORMs. He is very  much of the opinion that we should not
use an ORM at all in Rails, at least he leans in that direction. While I am not such an
extremist, I have been tempering my enthusiasm for ActiveRecord with recent real world
experience dealing with performance issues.</p>

<h2>ActiveRecord is Fat</h2>

<p>How fat? When ActiveRecord sits around the house, it sits AROUND the house. I know bad
joke. Look, all the magic ActiveRecord does requires a significant amount
code which then leads to large amount of <a href="https://blog.engineyard.com/2009/thats-not-a-memory-leak-its-bloat/">memory</a>
used to spin up an instance. Spin up a lot of ActiveRecord instance you can easily consume
all the available memory on the box.</p>

<p>ActiveRecord instances do a lot: persistence, validation, query generation, domain logic
and more. Yes it makes things easy and possibly makes code more readable but you&rsquo;re adding
complexity at least in the background. If you&rsquo;ve ever run into a new deep ActiveRecord bug,
good luck digging into that code for the first time.</p>

<h2>Your Classes Become Dependent on ActiveRecord</h2>

<p>Let compare two versions of code. One uses ActiveRecord, the other does not.</p>

<figure class='code'><figcaption><span>With ActiveRecord</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#app/service/foo.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Foo</span>
</span><span class='line'>  <span class="n">attributes</span> <span class="ss">:business</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#business is an ActiveRecord instance</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">business</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@business</span> <span class="o">=</span> <span class="n">business</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">run</span>
</span><span class='line'>    <span class="n">owners</span> <span class="o">=</span> <span class="n">business</span><span class="o">.</span><span class="n">owners</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">owners</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#app/service/biz.rb</span>
</span><span class='line'><span class="no">Foo</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Business</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Without ActiveRecord</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#app/service/foo.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Bar</span>
</span><span class='line'>  <span class="n">attributes</span> <span class="ss">:owners</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#owners is an Array of Hashes</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">owners</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@owners</span> <span class="o">=</span> <span class="n">owners</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">run</span>
</span><span class='line'>    <span class="n">owners</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">owner</span><span class="o">|</span> <span class="n">owner</span><span class="o">[</span><span class="s2">&quot;name&quot;</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#app/service/biz.rb</span>
</span><span class='line'><span class="no">Bar</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Business</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">owners</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:attributes</span><span class="p">))</span><span class="o">.</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Foo class is dependent on ActiveRecord. In order to run my rspec
tests on this code I&rsquo;ll have to load rails. Foo also expects the business
object to respond to #owners and each instance of owner to respond to #name.
This is quite a bit that we&rsquo;re asking Foo to know about the business object.
Foo is also sensitive to changes made to Business as well such that if we chose
to drop or rename the association to owners, the class would break.
A good article related to this is <a href="https://pragprog.com/articles/tell-dont-ask">&ldquo;Tell, Don&rsquo;t Ask&rdquo;</a>
which warns about this type of inadvertent coupling.</p>

<p>What we should be sending Foo is data not an object containing data that then needs
to be queried through it&rsquo;s api. Yes, I know a Hash is still
an object but I&rsquo;m speaking semantically. As you can see, Bar is given a Hash only.
There is no dependency on rails so my test can be run without loading rails and thus
can be run much faster. We no longer have the coupling we witnessed before.</p>

<h2>ActiveRecord is Lousy at Generating SQL</h2>

<p>It&rsquo;s not the fault of ActiveRecord, ORMs all have their limits.
For simple queries it works fine. Realize though that as your queries become
more complex and intricate the worse the SQL will be that AR generates. There&rsquo;s
just no way an ORM can craft a highly optimized complex query better than an
experienced engineer.</p>

<p>A backwards thing I catch myself doing sometimes is mentally figuring out how a non-trivial
query would be crafted in SQL and then I try to rewrite it into AR. I think at that point
I should do it in SQL.</p>

<h2>ActiveRecord, not so readable</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Report</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">execute</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">main_sql_string</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#=&gt; Main Query</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">main_sql_string</span>
</span><span class='line'>    <span class="o">&lt;&lt;-</span><span class="no">SQL</span>
</span><span class='line'><span class="sh">      SELECT businesses.name AS business_name, </span>
</span><span class='line'><span class="sh">        COALESCE(offer.name, format(&#39;Campaign ID - %s&#39;,offer.id::text)) AS campaign_name, </span>
</span><span class='line'><span class="sh">        COALESCE(user_replied.count,0) AS user_replied_count,</span>
</span><span class='line'><span class="sh">      FROM businesses</span>
</span><span class='line'><span class="sh">      INNER JOIN offer</span>
</span><span class='line'><span class="sh">        ON businesses.id = offer.business_id</span>
</span><span class='line'><span class="sh">      LEFT OUTER JOIN (#{user_replied_sql_string}) user_replied</span>
</span><span class='line'><span class="sh">        ON offer.id = user_replied.offer_id</span>
</span><span class='line'><span class="no">    SQL</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#=&gt; Subqueries</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">user_replied_sql_string</span>
</span><span class='line'>    <span class="o">&lt;&lt;-</span><span class="no">SQL</span>
</span><span class='line'><span class="sh">      SELECT cc_links.offer_id AS offer_id, COUNT(*) AS count </span>
</span><span class='line'><span class="sh">      FROM conversations</span>
</span><span class='line'><span class="sh">      INNER JOIN cc_links</span>
</span><span class='line'><span class="sh">        ON conversations.id = cc_links.conversation_id</span>
</span><span class='line'><span class="sh">      WHERE conversations.status = &#39;#{Conversation::Status::REPLIED_TO}&#39; </span>
</span><span class='line'><span class="sh">      GROUP BY cc_links.offer_id</span>
</span><span class='line'><span class="no">    SQL</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Take a look at code above. Can you imagine writing this in ActiveRecord. You&rsquo;d
have various calls to #joins, #group, #select, #from plus a fair share
of SQL fragments strewn about. For me the code above appears far more legible
that trying to express it in AR.</p>

<p>The last point I like to make is that I think there&rsquo;s an illness going around.
It might be caused by overzealous enthusiasm, inexperience or unwavering conviction.
But I&rsquo;ve seen it so many times; people become entranced with an ideal, rushing towards it
like a month to flame without the slightest thought to consequence or foresight. Again
I&rsquo;m a fan of ActiveRecord for the ease it brings but let&rsquo;s also consider the cost
as well.</p>

<p>Take Care.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/19/easy-vs-simple/">Easy vs Simple</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-19T16:47:24-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:47 pm</span></time>
        
           | <a href="/blog/2015/04/19/easy-vs-simple/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/19/easy-vs-simple/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/easy_street.jpg" width="300"></p>

<p>The meaning of words naturally evolve over time. As a consequence certain words
will unfortunately lose their distinctive meaning and become an undistinguished
synonym for another word. This is what I believe has happened with the words
&lsquo;easy&rsquo; and &lsquo;simple&rsquo; which are now used quite interchangeablely. The original
meaning of these words can help us illustrate a very important idea.</p>

<p>We&rsquo;ll start by looking at their definitions.</p>

<h2>Definitions</h2>

<blockquote><p>easy - requiring little effort; presenting few difficulties; not difficult.</p><p>simple - easily done, used, or understood.</p><footer><strong>Macmillian Dictionary for Students</strong></footer></blockquote>


<p>As you can see these words are very close in meaning today. Let&rsquo;s take a look
at what they used to mean.</p>

<h2>Origins</h2>

<p>&lsquo;Easy&rsquo; originally came from the Latin word ADJACERE which means to lie near. This
makes sense as those things which lie near physically or mentally are easy to
reach.</p>

<p>&lsquo;Simple&rsquo; comes for the Latin word SIMPLEX which means single fold. In other words
something is simple when it consists of very few parts. Thus when something
has little in the way of parts it then is not a difficult thing to grasp.</p>

<h2>Observations</h2>

<p>I&rsquo;d like to point out the origin of &lsquo;easy&rsquo; implies a certain subjectivity. As
things which are easy for me (near my mind) ,due to my experience, may not
be easy for someone else. In contrast &lsquo;simple&rsquo; is more objective. The more parts
and more intertwined and dependent those parts are of a thing, the less simple
that thing is.</p>

<p>For example Spanish is a simple language, Grammatically, it has fewer
irregularities than other romance languages. This would be an objective
statement.</p>

<p>However Spanish is easy for me since it&rsquo;s my first language and
difficult for my wife since she does not speak it. Thus we see easy
take on a more subjective role.</p>

<h2>Okay, so what?</h2>

<p>We are obsessed with the easy at the cost of complexity.The benefits or
detriments can be argued but it is none the less there. It is easy (close, near)
to go to the market and purchase a carton of orange juice but have you ever
wondered how complex (many parts) it was to produce that carton and it&rsquo;s contents?</p>

<p>It&rsquo;s far easier to use power windows but the mechanism has many parts and with
many parts comes the probability that something will go wrong sooner than a simpler
mechanism,  requiring service. It can be easy to ship a package but not so simple to find
one lost in the labyrinth it traveled.</p>

<p>Cheating, stealing and lying are all easy. We gain what we desire immediately.
The consequence is complexity. Keeping track of the lies told, avoiding discovery,
and having people distrust and hate us does not a simple life make.</p>

<p>This trade off between easy and simple is especially of concern to those who
build things such as engineers. Some select at tool or technique because
of it&rsquo;s ease of use yet it may actually lead to a complex structure which is
difficult to maintain and service.</p>

<p>Keep this in mind when doing something because it&rsquo;s easy.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/16/tgif-3/">TGIF 3</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-16T22:07:46-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:07 pm</span></time>
        
           | <a href="/blog/2015/04/16/tgif-3/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/16/tgif-3/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Welcome back to TGIF 3. The theme for this set of videos is, &ldquo;Videos that soundly
utterly boring but in the end I found deeply interesting.&rdquo;</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/lT55_u8URU0" frameborder="0" allowfullscreen></iframe>
</div>


<p>Kintsugi is the  Japanese art of fixing broken pottery with lacquer
dusted or mixed with powdered gold, silver, or platinum. Instead of hiding the
imperfections of the breaks, they are flaunted.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/t__AN6d8FWQ" frameborder="0" allowfullscreen></iframe>
</div>


<p>This is a documentary on the Helvetica font. Yes that&rsquo;s right. Someone made a documentary&hellip;
about a font. I found it a very interesting voyage into the world of typography.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/Fypi6dAJB8E" frameborder="0" allowfullscreen></iframe>
</div>


<p>This video exposed me to the interesting world of ink. I had no idea so much art and science
went into the process.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/ZbK92bRW2lQ" frameborder="0" allowfullscreen></iframe>
</div>


<p>This is an episode of Nova covering Mandelbrot and fractals. Sounds like a real snooze
fest but it turned out to be quite interesting.</p>

<p>Well that&rsquo;s it. Have a great weekend.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/14/tips-for-faster-queries/">Tips for Faster Queries</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-14T19:54:54-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:54 pm</span></time>
        
           | <a href="/blog/2015/04/14/tips-for-faster-queries/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/14/tips-for-faster-queries/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/fast_snail.jpg" width="300"></p>

<p>For the last few weeks I&rsquo;ve been busy at work optimizing many of our
slowest queries. On my last Rails related post I covered a work around for
PostgreSQL&rsquo;s inherit slowness with COUNT queries. On this post I&rsquo;m covering
some common tips for speeding up general queries.</p>

<p>We&rsquo;ll start by looking at some code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#app/serializers/business_serializer.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">BusinessSerializer</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serializer</span>
</span><span class='line'>  <span class="n">attributes</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:zip</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#app/controllers/businesses_controller#any_ten_records</span>
</span><span class='line'><span class="no">Business</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;revenue + ? = ?&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the code above I use <a href="https://github.com/rails-api/active_model_serializers">ActiveModel::Serializers</a>
to describe which model attributes will be serialized into JSON. If you are unfamiliar
with this gem consider reading up on it. It&rsquo;s pretty handy for DRYing up your code. The
database I am using is PostgreSQL.</p>

<h2>Don&rsquo;t SELECT *</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Business.where(&quot;revenue + ? = ?&quot;, params[:amount], 100).order(:created_at).to_a.first(10)</span>
</span><span class='line'><span class="no">Business</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:zip</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;revenue + ? = ?&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">to_a</span>
</span><span class='line'>  <span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The serailizer tells me that the only thing I need to return is <code>business#name</code>
and <code>business#zip</code>. The more record columns you request data on, the slower your
query might run as it will use more Network I/O and sometimes Disk I/O.
You could boost performance by selecting only the columns you require.</p>

<h2>Filter Rows With Limit</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Business.select(:name, :zip)</span>
</span><span class='line'><span class="c1">#  .where(&quot;revenue + ? = ?&quot;, params[:amount], 100)</span>
</span><span class='line'><span class="c1">#  .order(:created_at)</span>
</span><span class='line'><span class="c1">#  .to_a</span>
</span><span class='line'><span class="c1">#  .first(10)</span>
</span><span class='line'><span class="no">Business</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:zip</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;revenue + ? = ?&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see from <code>#first(10)</code> that we are only interested in returning the first
ten records we fetched from the query. We could potentially and unnecessarily
request a huge record set and consume a ton of memory by instantiating those
records as ActiveRecord objects.</p>

<h2>Avoid Sorting</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Business.select(:name, :zip)</span>
</span><span class='line'><span class="c1">#  .where(&quot;revenue + ? = ?&quot;, params[:amount], 100)</span>
</span><span class='line'><span class="c1">#  .limit(10)</span>
</span><span class='line'><span class="c1">#  .order(:created_at)</span>
</span><span class='line'><span class="no">Business</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:zip</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;revenue + ? = ?&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sorting is sometimes unavoidable but we should try not to utilize it when
possible. The <code>ORDER BY</code> generated will consume sorting memory on the server.
In cases where memory becomes scarce on the server, it will spill over to
disk making it painfully slow.</p>

<h2>Don&rsquo;t Accidentally Skip Using an Index</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Business.select(:name, :zip)</span>
</span><span class='line'><span class="c1">#  .where(&quot;revenue + ? = ?&quot;, params[:amount], 100)</span>
</span><span class='line'><span class="c1">#  .limit(10)</span>
</span><span class='line'><span class="no">Business</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:zip</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;revenue = ? - ?&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the businesses table is using an index on the field revenue, the original code
would skip using the index. To take advantage of the index we need to shift the
calculation from the left hand side of the equation to the right hand side.</p>

<p>Thank you for coming by. Feel free to share and comment below.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/12/build-measure-learn/">Build Measure Learn</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-12T14:34:48-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:34 pm</span></time>
        
           | <a href="/blog/2015/04/12/build-measure-learn/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/12/build-measure-learn/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/build-measure-learn.jpg" width="300"></p>

<p>Some months ago I came across a list of top books recommended by
successful entrepreneurs. Towards the top of this list was the
book &lsquo;The Lean Startup&rsquo;. I highly recommend this book to anyone
looking to start their own business or anyone involved in management.</p>

<p>One of the major concepts in the lean startup method is what&rsquo;s referred to
as the Build-Measure-Learn feedback loop. The basic idea is a cycle of
of building a product, measuring success then learning from this measurement
and other actions so as to build a better product and finally start
the cycle again. It is a way managing uncertainty and risk.</p>

<p>Realize that it&rsquo;s the speed at which this cycle occurs that most likely
determines success. A startup or new venture has a limited amount of time
and/or funds in order to become a viable concern. Once these resources are
consumed and no other options are present; the startup is done. This is why
speed is of essence.</p>

<p>While the cycle seems straight forward, each of these points on the cycle
has it&rsquo;s challenges.</p>

<h2>Build</h2>

<p>The Lean Startup has the concept of a Minimal Viable Product or MVP.
The idea is that you never build more than what is needed to learn.
While we would all love to produce a beautiful finished and polished
piece of work, it comes at a price. The price is time and waste.</p>

<p>What benefit is it to create a &lsquo;wonderful&rsquo; product that no one will ever buy?
The end result is a tremendous investment in time with the end result of
learning that no one wants it. One could have learned this in a fraction
of the time and expense with an MVP.</p>

<h2>Measure</h2>

<p>Learn to measure and track meaningful things that will guide you in determining
if your product is proving successful. The book covers in detail the difference
between actionable metrics and vanity metrics. In order for a metric to be
actionable it must demonstrate clear cause and effect. Otherwise the metric
could lead you astray giving you a false sense of security.</p>

<h2>Learn</h2>

<p>Are you taking what you&rsquo;ve learned from your metrics to build an even better
product or are you randomly dropping in product features and strategies simply
because it &lsquo;feels right&rsquo; or it sounds like a &lsquo;good idea&rsquo;? At what point do
you make a fundamental change to your business based on the learning done
so far? What have we learned and what are we doing about it?</p>

<p>I hope you enjoyed this little article.</p>

<p>The last couple of weeks I&rsquo;ve been sticking to a pattern that has worked well
for me for releasing new blog content. On Mondays I&rsquo;ll post an article on self
improvement or health related topic. Wednesday I&rsquo;ll release an article for
folks doing software development and Fridays I&rsquo;ll close out the week with
something fun such as some interesting Youtube videos. Thanks to all my
return visitors. I hope you come back soon.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/10/tgif-2/">TGIF 2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-10T15:06:29-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:06 pm</span></time>
        
           | <a href="/blog/2015/04/10/tgif-2/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/10/tgif-2/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello All and Thank God It&rsquo;s Friday. It&rsquo;s been a very busy week
and I ready to relax with some fun vids. In view that the release
of Avengers 2 is right around the corner, I think we&rsquo;ll theme this post
with one my favorite Avengers, Thor.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/-H3CwENDXn8" frameborder="0" allowfullscreen></iframe>
</div>


<p>Let&rsquo;s start with a comic book history lesson. It would surprise you to know
that Thor used to have a secret identity.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/i_xFOmYxKYw" frameborder="0" allowfullscreen></iframe>
</div>


<p>What&rsquo;s more epic than an epic rap battle? Nothing of course.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/6M5pYyW6lLw" frameborder="0" allowfullscreen></iframe>
</div>


<p>If you&rsquo;re like me then sometimes you lay awake at night wondering who would win
in fight; Thor or Superman?</p>

<div style="text-align:center;">
<iframe width="420" height="315" src="https://www.youtube.com/embed/DOOdNZbbpg4" frameborder="0" allowfullscreen></iframe>
</div>


<p>If you&rsquo;re fan of the old Hulk television series, you might be happy to know that
there was a television movie a few years after the series was cancelled with
an appearance of Thor.</p>

<p>Well, that&rsquo;s it for now. Have a good one.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/07/faster-count-queries/">Faster Count Queries</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-07T16:11:47-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:11 pm</span></time>
        
           | <a href="/blog/2015/04/07/faster-count-queries/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/07/faster-count-queries/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/cheetah_still.jpg" width="150"></p>

<p>Some of you have noticed that PostgreSQL&rsquo;s count performs painfully slow on tables
of any significant size. If you&rsquo;re looking for a quick solution and you don&rsquo;t
care about super exact numbers on the count then I&rsquo;ll show you what I did.</p>

<p>The reason counts are so slow in postgres has to do with the way Multi-Version
Concurrency Control(MVCC) has been implemented in the
<a href="http://wiki.postgresql.org/wiki/Slow_Counting">product</a>. Since multiple transactions
can see different states of the data then there can be no straightforward way for &ldquo;COUNT(*)&rdquo;
to summarize data across the whole table. As a result postgres must walk through all rows
in a sense.</p>

<p>I found an interesting article on how to accomplish a much faster, although less accurate
count by tapping into the EXPLAIN output through a custom <a href="https://wiki.postgresql.org/wiki/Count_estimate">function</a>.
I&rsquo;ll walk you through the steps I took.</p>

<figure class='code'><figcaption><span>count_estimate function</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">count_estimate</span><span class="p">(</span><span class="n">query</span> <span class="nb">text</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">integer</span> <span class="k">AS</span>
</span><span class='line'><span class="err">$</span><span class="n">func</span><span class="err">$</span>
</span><span class='line'><span class="k">DECLARE</span>
</span><span class='line'>    <span class="n">rec</span>   <span class="n">record</span><span class="p">;</span>
</span><span class='line'>    <span class="k">rows</span>  <span class="nb">integer</span><span class="p">;</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>    <span class="k">FOR</span> <span class="n">rec</span> <span class="k">IN</span> <span class="k">EXECUTE</span> <span class="s1">&#39;EXPLAIN &#39;</span> <span class="o">||</span> <span class="n">query</span> <span class="n">LOOP</span>
</span><span class='line'>        <span class="k">rows</span> <span class="p">:</span><span class="o">=</span> <span class="k">substring</span><span class="p">(</span><span class="n">rec</span><span class="p">.</span><span class="ss">&quot;QUERY PLAN&quot;</span> <span class="k">FROM</span> <span class="s1">&#39; rows=([[:digit:]]+)&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">EXIT</span> <span class="k">WHEN</span> <span class="k">rows</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
</span><span class='line'>    <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">RETURN</span> <span class="k">rows</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span>
</span><span class='line'><span class="err">$</span><span class="n">func</span><span class="err">$</span> <span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Above is the create query for out SQL function that we&rsquo;ll need to create on the server.
First we&rsquo;ll create a migration to hold our function creation statement.</p>

<figure class='code'><figcaption><span>migration</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#run this at the console first</span>
</span><span class='line'><span class="c1">#  bundle exec rails g migration AddCountEstimateFunction</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">AddCountEstimateFunction</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>    <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span>
</span><span class='line'><span class="sh">      CREATE FUNCTION count_estimate(query text) RETURNS integer AS</span>
</span><span class='line'><span class="sh">      $func$</span>
</span><span class='line'><span class="sh">      DECLARE</span>
</span><span class='line'><span class="sh">          rec   record;</span>
</span><span class='line'><span class="sh">          rows  integer;</span>
</span><span class='line'><span class="sh">      BEGIN</span>
</span><span class='line'><span class="sh">          FOR rec IN EXECUTE &#39;EXPLAIN &#39; || query LOOP</span>
</span><span class='line'><span class="sh">              rows := substring(rec.&quot;QUERY PLAN&quot; FROM &#39; rows=([[:digit:]]+)&#39;);</span>
</span><span class='line'><span class="sh">              EXIT WHEN rows IS NOT NULL;</span>
</span><span class='line'><span class="sh">          END LOOP;</span>
</span><span class='line'><span class="sh">       </span>
</span><span class='line'><span class="sh">          RETURN rows;</span>
</span><span class='line'><span class="sh">      END</span>
</span><span class='line'><span class="sh">      $func$ LANGUAGE plpgsql;</span>
</span><span class='line'><span class="no">    SQL</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>    <span class="n">execute</span> <span class="s2">&quot;DROP FUNCTION count_estimate(query text);&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>After we run <code>bundle exec rake db:migrate</code> the function will be available for use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT count_estimate(&#39;</span><span class="si">#{</span><span class="n">sql_query</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Example:</span>
</span><span class='line'><span class="c1">#  sql_query = &quot;SELECT * FROM businesses WHERE size &gt; 3&quot;</span>
</span><span class='line'><span class="c1">#  ActiveRecord::Base.connection.execute(&quot;SELECT count_estimate(&#39;#{sql_query}&#39;)&quot;).to_a</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">#returns</span>
</span><span class='line'><span class="c1">#  [{&quot;count_estimate&quot; =&gt; &quot;500&quot;}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The snippet above shows how you would now use this SQL function</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Business</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">comment_count</span>
</span><span class='line'>    <span class="c1">#This will return an estimate but not exactly the real number</span>
</span><span class='line'>    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT count_estimate(&#39;</span><span class="si">#{</span><span class="n">comments_sql_string</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">[</span><span class="s2">&quot;count_estimate&quot;</span><span class="o">].</span><span class="n">to_i</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">comments_sql_string</span>
</span><span class='line'>    <span class="o">&lt;&lt;-</span><span class="no">SQL</span>
</span><span class='line'><span class="sh">      SELECT * FROM comments </span>
</span><span class='line'><span class="sh">      WHERE comments.business_id = #{self.id} </span>
</span><span class='line'><span class="sh">        AND comments.status = &#39;&#39;new&#39;&#39;</span>
</span><span class='line'><span class="no">    SQL</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Business.last.comment_count</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">#=&gt; 9</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, here is a more fleshed out implementation. Just a note, but make sure you character escape
those single quotes by using two single quotes <code>''</code> otherwise you&rsquo;ll get a SQL error on the syntax.</p>

<p>If this was useful then please share on your social media connections. I also like hearing
any suggestions and comments so feel free to drop some below.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/05/the-pareto-principle/">The Pareto Principle</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-05T17:51:33-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:51 pm</span></time>
        
           | <a href="/blog/2015/04/05/the-pareto-principle/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/05/the-pareto-principle/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There is a very powerful principle and it can be quite
transformative if you can learn to spot it and apply it to your daily life.
I first became aware of the Pareto Principle when I worked as a
developer at a company in the business of selling software to mid-level
manufacturing companies.</p>

<p><img class="right" src="/images/pareto-principle.jpg" width="300"></p>

<p>The Pareto Principle goes by many names such the 80/20 principle, Pareto&rsquo;s
Law, the law of the vital few and more. What it basically states is that
20% of the causes drive 80% of the effects. Another way of saying this is
that 20% of the inputs results in 80% of the outputs. For example a company
will likely find that 20% of their customers generate 80% of their income.</p>

<p>Microsoft found that fixing the top 20% of the most reported bugs eliminated
80% of the related errors and crashes in a given <a href="http://en.wikipedia.org/wiki/Pareto_principle">system</a>.
Other observations have included things such as:</p>

<ul>
<li>20% of motorists cause 80% of traffic accidents</li>
<li>20% of criminals account for 80% of the value of all crime</li>
<li>20% of the clothes a person person owns is worn 80% of the time.</li>
</ul>


<p>I was recently reintroduced to the principle upon reading Tim Ferriss&#8217; book,
The 4-hour Workweek. He drives home the idea of eliminating waste through its
use and this is one way the principle can be transformative.</p>

<p>If a company realizes that 80% of it&rsquo;s time is consumed by 20% of its customers
then it must ask itself the hard question, &ldquo;Should we part ways with those clients.&rdquo;
If those clients are contribiting only a small amount of the revenue but
are capitalizing most of the time then indeed parting ways maybe the smart choice.</p>

<p>We may find in our own daily lives that 20% of our activities consume
80% of our time. These activities could consist of web surfing, answering
emails, and other unproductive activities. Should we remove or greatly
limit these activities then we could recoop signifact chunks of time
as well as reduce our stress.</p>

<p>Give it some thought and see if this principle can be applied to an area
of your life, activity or business.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/02/tgif/">TGIF</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-02T22:27:12-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>10:27 pm</span></time>
        
           | <a href="/blog/2015/04/02/tgif/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/02/tgif/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the things I&rsquo;m finding pretty fun these last few fridays is
watching some good youtube vids. I have a pretty eclectic taste so I think
you might find some of these interesting to you.
What I&rsquo;d like to shoot for is sharing some of the more interesting
videos every Friday.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/YxgsxaFWWHQ" frameborder="0" allowfullscreen></iframe>
</div>


<p>If you&rsquo;re like me and love the Lord of the Rings films but don&rsquo;t have the patience to slug
through hundreds of pages of fiction then this video is for you. It gives you a nice
background on the mythos of the LOTR universe.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/WKU0qDpu3AM" frameborder="0" allowfullscreen></iframe>
</div>


<p>Speaking of LOTR, have you watched the trilogy only to ask yourself, &ldquo;&hellip;So what does the One Ring
do again?&rdquo;. Well then this video is just for you.</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/HeYfIv5s10A" frameborder="0" allowfullscreen></iframe>
</div>


<p>Want a theory for the existence of the Hulk? Kyle Hill takes a stab at the question
with some science. Oh yeah!</p>

<div style="text-align:center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/tUEkqZxLyrg" frameborder="0" allowfullscreen></iframe>
</div>


<p>If you&rsquo;re a big ol&#8217; comic book geek like me then you&rsquo;re loving all the little bits of news
trickling in about the upcoming Deadpool movie.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/01/binding-object-intro/">Binding Object Intro</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-01T18:04:49-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>6:04 pm</span></time>
        
           | <a href="/blog/2015/04/01/binding-object-intro/#disqus_thread"
             data-disqus-identifier="http://www.verygoodindicators.com/blog/2015/04/01/binding-object-intro/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The following is a quick intro to Ruby&rsquo;s Binding object. The Binding object
holds the execution context of that particular scope. You can evaluate
variables against a particular binding to fetch or set the values of those
variables. Let&rsquo;s look at some code and then walkthrough what is happening.</p>

<p>What we&rsquo;re going to do in the following piece of code is capture the local
variables within the scope of Foo#run and send them to our error reporting
service which simply puts out the results to the console. In this example I am
using Ruby version 2.2.1.</p>

<figure class='code'><figcaption><span>Binding object example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Foo</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">run</span>
</span><span class='line'>    <span class="n">fruit</span> <span class="o">=</span> <span class="s2">&quot;apple&quot;</span>
</span><span class='line'>    <span class="n">vegi</span>  <span class="o">=</span> <span class="s2">&quot;corn&quot;</span>
</span><span class='line'>    <span class="n">nut</span>   <span class="o">=</span> <span class="s2">&quot;peanut&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="k">raise</span>
</span><span class='line'>    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>      <span class="n">report_error</span><span class="p">(</span><span class="n">capture_variables</span><span class="p">(</span><span class="nb">binding</span><span class="p">,</span> <span class="o">[</span><span class="ss">:e</span><span class="o">]</span><span class="p">))</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">protected</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#error reporting service</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">report_error</span><span class="p">(</span><span class="n">var_hash</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">var_hash</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">capture_variables</span><span class="p">(</span><span class="n">previous_binding</span><span class="p">,</span> <span class="n">skip_vars</span> <span class="o">=</span> <span class="o">[]</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">#                    -- returns [:fruit, :vegi, :nut, :e]</span>
</span><span class='line'>    <span class="c1">#                   / </span>
</span><span class='line'>    <span class="n">previous_binding</span><span class="o">.</span><span class="n">local_variables</span><span class="o">.</span><span class="n">inject</span><span class="p">({})</span> <span class="k">do</span> <span class="o">|</span><span class="nb">hash</span><span class="p">,</span><span class="n">var</span><span class="o">|</span>
</span><span class='line'>      <span class="k">begin</span>
</span><span class='line'>        <span class="c1"># Binding#local_variable_get will fetch the value of the local variable</span>
</span><span class='line'>        <span class="c1">#   for example Binding#local_variable_get(:fruit) returns &quot;apple&quot;</span>
</span><span class='line'>        <span class="nb">hash</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="n">var</span> <span class="o">=&gt;</span> <span class="n">previous_binding</span><span class="o">.</span><span class="n">local_variable_get</span><span class="p">(</span><span class="n">var</span><span class="p">))</span> <span class="k">unless</span> <span class="n">skip_vars</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</span><span class='line'>      <span class="k">rescue</span> <span class="no">NameError</span>
</span><span class='line'>        <span class="c1">#We rescue NameError due to a weird artifact that raise creates.</span>
</span><span class='line'>        <span class="c1">#The artifact appears to be a local variable but &#39;raises&#39; an error</span>
</span><span class='line'>        <span class="c1">#  when any attempt to evaluate it occurs.</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="nb">hash</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you notice on lines 3-4, we&rsquo;ve set a few local variables. On line 8, we
intentionally raise an error. Line 10 sends our reporting service a hash
containing all variables in that scope with their values. The hash is
generated by the method #capture_variables.</p>

<p>Here&rsquo;s how the method works. We send it the current binding by simply sending it
&lsquo;binding&rsquo; as seen on line 10. We also send it an array of symbols representing any local
variables we&rsquo;re not interested in reporting which in our case is &lsquo;e&rsquo;.</p>

<p>On line 22 we call Binding#local_variables which returns an array of symbols
representing the local variables we defined. We iterate over the collection
of symbols with #inject so as to build a hash with the keys being the
variable names and the values the variable values.</p>

<p>On line 27 we call Binding#local_variable_get to fetch the value of the local
variable as defined in previous execution context. Now we execute Foo.new.run to
see what we get.</p>

<figure class='code'><figcaption><span>Console Output </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='irb'><span class='line'><span class="gp">&gt;&gt; </span><span class="no">Foo</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">run</span>
</span><span class='line'><span class="gp">&gt;&gt; </span><span class="p">{</span><span class="ss">:fruit</span><span class="o">=&gt;</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="ss">:vegi</span><span class="o">=&gt;</span><span class="s2">&quot;corn&quot;</span><span class="p">,</span> <span class="ss">:nut</span><span class="o">=&gt;</span><span class="s2">&quot;peanut&quot;</span><span class="p">}</span>
</span><span class='line'><span class="gp">&gt;&gt; </span><span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see above our reporting service is receiving the hash as expected.</p>

<p>Feel free to drop some comments or questions below. And if you liked it then
please share on twitter, facebook or your prefered social media channel.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    

<section>
  <h1>Topics</h1>
    <ul id="category-list" class="group"><li><a href='/blog/categories/biohacking'>biohacking (2)</a></li><li><a href='/blog/categories/books'>books (3)</a></li><li><a href='/blog/categories/debt'>debt (2)</a></li><li><a href='/blog/categories/diet'>diet (1)</a></li><li><a href='/blog/categories/funny'>funny (2)</a></li><li><a href='/blog/categories/linguistics'>linguistics (1)</a></li><li><a href='/blog/categories/low-carb'>low carb (3)</a></li><li><a href='/blog/categories/making-money'>making money (4)</a></li><li><a href='/blog/categories/performance'>performance (4)</a></li><li><a href='/blog/categories/programming'>programming (6)</a></li><li><a href='/blog/categories/recipes'>recipes (2)</a></li><li><a href='/blog/categories/technology'>technology (1)</a></li><li><a href='/blog/categories/tgif'>tgif (3)</a></li></ul>
</section>



<section style="clear: both">
  <h1>Keywords</h1>
    <span id="tag-cloud"><a href='/blog/tags/-100-startup' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>$100 startup</a> <a href='/blog/tags/80-20' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>80/20</a> <a href='/blog/tags/athletic-performance' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>athletic performance</a> <a href='/blog/tags/bake-free' style='font-size: 120.0%; padding: 0.16666666666666666em 0.16666666666666666em 0.16666666666666666em 0.16666666666666666em'>bake free</a> <a href='/blog/tags/binding-object' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>Binding object</a> <a href='/blog/tags/books' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>books</a> <a href='/blog/tags/breakfast' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>breakfast</a> <a href='/blog/tags/chocolate' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>chocolate</a> <a href='/blog/tags/class-class' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>class Class</a> <a href='/blog/tags/constructors' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>constructors</a> <a href='/blog/tags/credit-card' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>credit card</a> <a href='/blog/tags/debt' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>debt</a> <a href='/blog/tags/dessert' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>dessert</a> <a href='/blog/tags/diaphragm' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>diaphragm</a> <a href='/blog/tags/entrepreneurship' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>entrepreneurship</a> <a href='/blog/tags/grammar' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>grammar</a> <a href='/blog/tags/grammar-nazi' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>grammar nazi</a> <a href='/blog/tags/income' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>income</a> <a href='/blog/tags/lungs' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>lungs</a> <a href='/blog/tags/o2' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>o2</a> <a href='/blog/tags/o2-trainer' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>o2 trainer</a> <a href='/blog/tags/oatmeal' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>oatmeal</a> <a href='/blog/tags/pareto-principle' style='font-size: 110.0%; padding: 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em 0.08333333333333333em'>pareto principle</a> <a href='/blog/tags/postgres' style='font-size: 120.0%; padding: 0.16666666666666666em 0.16666666666666666em 0.16666666666666666em 0.16666666666666666em'>postgres</a> <a href='/blog/tags/rails' style='font-size: 130.0%; padding: 0.25em 0.25em 0.25em 0.25em'>rails</a> <a href='/blog/tags/ror' style='font-size: 130.0%; padding: 0.25em 0.25em 0.25em 0.25em'>ror</a> <a href='/blog/tags/ruby' style='font-size: 160.0%; padding: 0.5em 0.5em 0.5em 0.5em'>ruby</a> </span>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Mentaware Media -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'verygoodindicators';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<!-- Place this snippet wherever appropriate -->
<script type="text/javascript">
  (function() {
    var li = document.createElement('script'); li.type = 'text/javascript'; li.async = true;
    li.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + '//platform.stumbleupon.com/1/widgets.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(li, s);
  })();
</script>




</body>
</html>
